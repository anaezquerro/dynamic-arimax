---
title: "Simulation Example"
author: "Ana Xiangning Pereira Ezquerro"
date:  "Versión `r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document:
    number_sections: yes
    latex_engine: lualatex
    fig_caption: yes
    toc: yes
    highlight: tango
    df_print: kable
    citation_package: biblatex
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    number_sections: true
    theme: paper
    highlight: tango
  prettydoc::html_pretty:
    toc: true
    df_print: paged
    number_sections: true
    theme: hpstr
    highlight: github
fontsize: 12pt
geometry: margin=0.7in
classoption: a4paper
documentclass: article
header-includes:
- \usepackage{sfmath}
- \renewcommand*\familydefault{\sfdefault}
- \renewcommand{\baselinestretch}{1.2}
- \setlength{\parskip}{1em}
- \usepackage{xcolor}
- \input{confi.tex}
always_allow_html: yes
bibliography: references.bib
biblio-style: bwl-FU
linkcitations: true
linkcolor: blue
lang: es
---

```{r, echo=F, warning=F, message=F}
# Cargamos las funciones
knitr::opts_chunk$set(fig.align='center', fig.width = 10, 
                      fig.height = 8, message=F, comment='', warning=F)
eval(parse("plot-tools.R", encoding="UTF-8"))
eval(parse("arima-simulation.R", encoding="UTF-8"))
eval(parse("auto-fit.R", encoding="UTF-8"))
eval(parse("auto-select.R", encoding="UTF-8"))
eval(parse("forecasting.R", encoding="UTF-8"))

# Librerías de series temporales
library(fpp2)
library(tseries)
library(TSA)
library(seastests)
library(forecast)

# Librerías para los gráficos
library(plotly)
library(forecast)

# Auxiliares
library(prettydoc)
library(stringi)
library(stringr)
library(polynom)
library(parallel)

# Función para mostrar y guardar las gráficas de plotly
display <- function(fig, name, width=800, height=400) {
  
  if (is.null(knitr::opts_knit$get("rmarkdown.pandoc.to"))) {
    return(fig)
  }
  if (knitr::opts_knit$get("rmarkdown.pandoc.to") == "latex") {
    figpath <- paste0('figures/', name, ".pdf")
    save_image(fig, figpath, width=width, height=height)
    return(knitr::include_graphics(figpath))
  }
  if (knitr::opts_knit$get("rmarkdown.pandoc.to") == "html") {
    fig <- fig %>% layout(width=840, height=700)
    return(fig)
  }
}

dir.create("figures", showWarnings=F)

# Cargamos los datos sobre las variables regresoras
load(file='simulations/X1 ~ ARIMA(2,1,3).RData')        # X1
load(file='simulations/X2 ~ ARIMA(1,1,2).RData')        # X2
load(file='simulations/X3 ~ ARIMA(1,0,2).RData')        # X3
load(file='simulations/residuals ~ ARIMA(2,0,1).RData') # residuos

# Cargamos las variables independientes
load(file='simulations/X4 ~ ARIMA(1,0,3).RData')        # X4
load(file='simulations/X5 ~ ARIMA(2,1,2).RData')        # X5
load(file='simulations/X6 ~ ARIMA(2,1,1).RData')        # X6


X1 <- X1$X; X2 <- X2$X; X3 <- X3$X
X4 <- X4$X; X5 <- X5$X; X6 <- X6$X
residuals <- residuals$X


```


```{r}
beta0 <- -0.6; beta1 <- 1.7; beta2 <- -2.2; beta3 <- 1.3; r1 <- 2; r3 <- 3
Y <- beta0 + beta1*lag(X1,-r1) + beta2*X2 + beta3*lag(X3,-r3) + residuals
xregs <- cbind(X1, X2, X3, X4, X5, X6)
ajuste <- drm.select(Y, xregs, ic='aicc', st_method='adf.test', show_info=F)
```


```{r}
print(ajuste$history, row.names=F)
print(ajuste, row.names=F)
```

```{r}
preds <- forecast_model(Y, xregs, ajuste, h=10, 
                        mode='bootstrap', levels=c(50, 75, 90))
```

